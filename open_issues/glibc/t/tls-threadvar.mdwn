[[!meta copyright="Copyright Â© 2011, 2012, 2013 Free Software Foundation,
Inc."]]

[[!meta license="""[[!toggle id="license" text="GFDL 1.2+"]][[!toggleable
id="license" text="Permission is granted to copy, distribute and/or modify this
document under the terms of the GNU Free Documentation License, Version 1.2 or
any later version published by the Free Software Foundation; with no Invariant
Sections, no Front-Cover Texts, and no Back-Cover Texts.  A copy of the license
is included in the section entitled [[GNU Free Documentation
License|/fdl]]."]]"""]]

[[!tag open_issue_glibc open_issue_libpthread]]

This basically means to get rid of `sysdeps/mach/hurd/bits/libc-tsd.h` (and
thus the `_HURD_THREADVAR_*`/`_hurd_threadvar_location` interface), and
directly use `__thread` instead.

[[!toc]]


# IRC, freenode, #hurd, 2011-10-23

    <tschwinge> youpi: If we want to replace threadvars with TLS, there is one
      problem: the threadvars interface is publically exported:
      /usr/include/hurd/threadvar.h.
    <tschwinge> youpi: But I am somewhat inclined to say that the only user of
      this is libthreads/libpthread.  Do you think differently?
    <youpi> tschwinge: that's very probable
    <youpi> so I think we can just drop it
    <youpi> (people should use TLS anyway)

[[libpthread_set_stack_size]].

After this has been done, probably the whole `__libc_tsd_*` stuff can be
dropped altogether, and `__thread` directly be used in glibc.


# IRC, freenode, #hurd, 2012-08-07

    <tschwinge> r5219: Update libpthread patch to replace threadvar with tls
      for pthread_self
    <tschwinge> r5224: revert r5219 too, it's not ready either
    <youpi> as the changelog says, the __thread revertal is because it posed
      problems
    <youpi> and I just didn't have any time to check them while the freeze was
      so close
    <tschwinge> OK.  What kind of problems?  Should it be reverted upstream,
      too?
    <youpi> I don't remember exactly
    <youpi> it should just be fixed
    <youpi> we can revert it upstream, but it'd be good that we manage to
      progress, at some point...
    <tschwinge> Of course -- however as long as we don't know what kind of
      problem, it is a bit difficult.  ;-)
    <youpi> since I didn't left a note, it was most probably a mere glibc run,
      or boot with the patched libpthread
    <youpi> *testsuite run
    <tschwinge> OK.
    <tschwinge> The libpthread testsuite doesn't show any issues with that
      patch applied, though.  But I didn'T test anything else.
    <tschwinge> youpi: Also, you have probably seen my glibc __thread errno
      email -- rmcgrath wanted to find some time this week to comment/help, and
      I take it you don't have any immediate comments to that issue?
    <youpi> I saw the mails, but didn't investigate at all

[[!message-id "878vdyqht3.fsf@kepler.schwinge.homeip.net"]].
