%TOC% %STARTINCLUDE%

# <a name="TWiki_Installation_Guide"> TWiki Installation Guide </a>

_Installation instructions for the TWiki 01-Sep-2001 production release_

## <a name="Overview"> Overview </a>

These installation steps are based on the Apache Web server on Linux. TWiki runs on other Web servers and Unix systems, and should be fine with any OS and server that meet the [[TWikiImplementationNotes]]. Documentation for other platforms is currently limited. For Windows, check TWiki:Codev/TWikiOnWindows. Search the TWiki:Codev web for other intallation notes.

<a name="StandardInstallation"></a>

## <a name="Standard_Installation"> Standard Installation </a>

Request and download the TWiki 01-Sep-2001 distribution in Unix ZIP format from <http://TWiki.org/download.html>. _(To install TWiki on SourceForge, for use on a software development project, read TWiki:Codev/SourceForgeHowTo.)_

### <a name="Step_1_Create_amp_Configure_the_"> Step 1: Create &amp; Configure the Directories </a>

**_NOTE:_** _If you don't have access to your Web server configuration files - for example, if you're installing on an ISP-hosted account - use the alternative Step 1 instead._

* Create directory `/home/httpd/twiki` and unzip the TWiki distribution into this directory.
* The `twiki/bin` directory of TWiki must be set as a cgi-bin directory. Add `/home/httpd/twiki/bin` to file `/etc/httpd/httpd.conf` with only `ExecCGI` option.
* The `twiki/pub` directory of TWiki must be set so that it is visible as a URL. Add `/home/httpd/twiki` to file `httpd.conf` with normal access options (copy from `/home/httpd/html` ).
* Now add `ScriptAlias` for `/twiki/bin` and `Alias` for `/twiki` to file `httpd.conf` . <br />**_NOTE:_** The `ScriptAlias` **_must_** come before the `Alias`, otherwise, Apache will fail to correctly set up `/twiki/bin/`, by treating it as just another subdirectory of the `/twiki/` alias.

> **Example `httpd.conf` entries:**
>
> <pre> Script<nop>Alias /twiki/bin/ "/home/httpd/twiki/bin/"
>  Alias /twiki/ "/home/httpd/twiki/"
>  &amp;lt;Directory "/home/httpd/twiki/bin"&amp;gt;
>     Options +ExecCGI
>     Set<nop>Handler cgi-script
>     Allow from all
>  &amp;lt;/Directory&amp;gt;
>  &amp;lt;Directory "/home/httpd/twiki/pub"&amp;gt;
>     Options Follow<nop>Sym<nop>Links +Includes
>     Allow<nop>Override None
>     Allow from all
>  &amp;lt;/Directory&amp;gt;</nop></nop></nop></nop></nop></pre>

* Restart Apache by `/etc/rc.d/rc5.d/S85httpd restart` .
* Test that the `twiki/bin` directory is CGI-enabled by trying visiting it in your browser:
  * Enter the URL for the `bin` directory, `http://yourdomain.com/twiki/bin/`.
  * Your settings are OK if you get a message like `"Forbidden. You don't have permission to access /twiki/bin/ on this server"`.
  * Settings are NOT correct if you get something like `"Index of /twiki/bin"` - recheck your `httpd.conf` file.

* _Go directly to Step 2..._

<a name="StepOneB"></a>

#### <a name="Step_1_for_Non_Root_Accounts"> Step 1 for Non-Root Accounts </a>

To install TWiki on a system where you don't have server administrator privileges, for example, on a hosted Web account:

* Download and unzip TWiki on your local PC
* Using the table below, create a directory structure on your host server
* Upload the TWiki files by FTP (transfer as _text_ except for the image files in `pub`)

> <table border="1" cellpadding="1" cellspacing="0">
>   <tr>
>     <th bgcolor="#99CCCC"><strong>TWiki dir:</strong></th>
>     <th bgcolor="#99CCCC"><strong>What it is:</strong></th>
>     <th bgcolor="#99CCCC"><strong>Where to copy:</strong></th>
>     <th bgcolor="#99CCCC"><strong>Example:</strong></th>
>   </tr>
>   <tr>
>     <td><code>twiki/bin</code></td>
>     <td> CGI bin </td>
>     <td> cgi-enabled dir </td>
>     <td><code>/home/smith/public_html/cgi-bin</code></td>
>   </tr>
>   <tr>
>     <td><code>twiki/lib</code></td>
>     <td> library files </td>
>     <td> same level as <code>twiki/bin</code></td>
>     <td><code>/home/smith/public_html/lib</code></td>
>   </tr>
>   <tr>
>     <td><code>twiki/pub</code></td>
>     <td> public files </td>
>     <td> htdoc enabled dir </td>
>     <td><code>/home/smith/public_html/pub</code></td>
>   </tr>
>   <tr>
>     <td><code>twiki/data</code></td>
>     <td> topic data </td>
>     <td> outside of htdoc tree (for security) </td>
>     <td><code>/home/smith/twiki/data</code></td>
>   </tr>
>   <tr>
>     <td><code>twiki/templates</code></td>
>     <td> web templates </td>
>     <td> outside of htdoc tree (for security) </td>
>     <td><code>/home/smith/twiki/templates</code></td>
>   </tr>
> </table>

<a name="StepTwo"></a>

### <a name="Step_2_Set_File_Permissions"> Step 2: Set File Permissions </a>

* Make sure Perl 5 and the Perl CGI library are installed on your system. The default location of Perl is `/usr/bin/perl`. If it's elsewhere, change the path to Perl in the first line of each script in the `twiki/bin` directory, or create a symbolic link from `/usr/bin/perl`.
  * **IMPORTANT:** On ISP-hosted accounts, Perl CGI scripts usually require a `.cgi` extension to run. Some systems need `.pl`, the regular Perl extension. Modify all `twiki/bin` script filenames if necessary.
* Set the file permission of all Perl scripts in the `twiki/bin` directory as executable to `-rwxr-xr-x` (755).
* To be able to edit the Perl scripts and `.tmpl` files it is necessary to `chown` and `chgrp -R twiki` so all the files have the owner you want.
* **_NOTE:_** This Guide assumes user `nobody` ownership for all files manipulated by the CGI scripts (executed by the Web server), and user `twiki` for all other files. You can:
  * replace `nobody` with another user if your server executes scripts under a different name (ex: default for Debian is `www-data`).
    * **HINT:** Run the `testenv` script from your browser: `http://yourdomain.com/twiki/bin/testenv`. It will show you the user name of the CGI scripts, a table listing all CGI environment variables, and a test of your `twiki/lib/TWiki.cfg` configuration file (you'll configure that in a minute).
  * replace user `twiki` with your own username
* Set the permission of all files below `twiki/data` so that they are writable by user `nobody`. A simple way is to `chmod` them to `-rw-rw-r--` (664) and to `chown` them to `nobody`.
* Set the permission of the `twiki/data` directory and its subdirectories so that files in there are writable by user `nobody`. A simple way is to chmod them to `drwxrwxr-x` (775) and to `chown` them to `nobody`.
* Set the permission of the `twiki/pub` directory and all its subdirectories so that files in there are writable by user `nobody`. A simple way is to `chmod` them to `drwxrwxr-x` (775) and to `chown` them to `nobody`.
* **_NOTE:_** The `twiki/data/*/*.txt,v` RCS repository files in the installation package are locked by user `nobody`. If your CGI scripts are **_not_** running as user `nobody`, it's not possible to check in files (you'll see that the revision number won't increase after saving a topic). In this case, you need to unlock all repository files (check the RCS man pages) and lock them with a different user, ex `www-data`, or delete them all - new files will be automatically created the first time each topic is edited. A simple way to change ownership is with a search-and-replace in all files; for example, using sed: <br />`for f in *,v; do sed 's/nobody\:/www-data\:/' $f > x; mv x $f; done`

### <a name="Step_3_Set_the_Main_Configuratio"> Step 3: Set the Main Configuration File </a>

* Edit the file `twiki/lib/TWiki.cfg`, setting the variables to your needs.
  * Set the file extension in the `$scriptSuffix` variable to `cgi` or `pl` if required.
  * Make sure RCS is installed. Set `$rcsDir` in `twiki/lib/TWiki.cfg` to mach the location of your RCS binaries.
* **Security issue:** Directories `twiki/data` , `twiki/templates` and all its subdirectories should be set so that they are **_not_** visible as a URL. (Alternatively, move the directories to a place where they are not visible, and change the variables in `twiki/lib/TWiki.cfg` accordingly)
* Test your settings by running the `testenv` script from your browser: `http://yourdomain.com/twiki/bin/testenv`. Check if your `twiki/lib/TWiki.cfg` configuration file settings are correct.

### <a name="Step_4_Finish_Up_from_Your_Brows"> Step 4: Finish Up from Your Browser </a>

* Point your Web browser at `http://yourdomain.com/twiki/bin/view` and start TWiki-ing away!
* Edit the [[TWikiPreferences]] topic in the TWiki:%TWIKIWEB% web to set the `WIKIWEBMASTER` email address, and other preferences.
* Edit the [[WebPreferences]] topic in each web, if necessary: set individual `WEBCOPYRIGHT` messages, and other preferences.
* Enable email notification of topic changes, [[MonitoringSiteActivity]] has more.
* Edit the [[WebNotify]] topic in all webs and add the users you want to notify.
* Add the TWiki:Main/PoweredByTWikiLogo to your %MAINWEB%.WebHome topic.
* You can add new <code>%VARIABLES%</code>. Define site-level variables in the [[TWikiPreferences]] topic. See also: [[TWikiVariables]].

That's it for the standard virgin installation of TWiki. Read on for server-level customization options.

## <a name="Additional_Server_Level_Options"> Additional Server-Level Options </a>

With your new TWiki installation up and running, you can manage most aspects of your site from the browser interface. Only a few functions require access to the server file system, via Telnet or FTP. You can make these server-level changes during installation, and at any time afterwards.

### <a name="Enabling_Authentication_of_Users"> Enabling Authentication of Users </a>

* If TWiki is installed on a non-authenticated server - not using SSL - and you'd like to authenticate users:
  1. **Rename** file `.htaccess.txt` in the `twiki/bin` directory to `.htaccess` and change it to your needs. For details, consult the HTTP server documentation (for Apache server: [[1]](http://www.apache.org/docs/mod/directives.html), [[2]](http://www.mcs.kent.edu/system/web_help/htaccess/introduction.html)). In particular, the following <font>red</font> part needs to be configured correctly: <br /><code>Redirect <font>/urlpath/to/TWiki/index.html</font> http://<font>your.domain.com/urlpath/to/TWiki/bin/</font>view</code><br /><code>AuthUserFile <font>/filepath/to/TWiki/data/</font>.htpasswd</code><br /><code>ErrorDocument 401 <font>/urlpath/to/TWiki/bin/</font>oops/TWiki/TWikiRegistration?template=oopsauth</code>
    * **_NOTE:_** In case you renamed the CGI script files to have a file extension you need to reflect that in the `edit`, `view`, `preview`, etc entries in `.htaccess`.
    * **_NOTE:_** The browser should ask for login name and password when you click on the <u>Edit</u> link. In case `.htaccess` does not have the desired effect you need to enable it: Add "AllowOverride All" to the Directory section of `access.conf` for your `twiki/bin` directory.
  2. **Copy** the [[TWikiRegistrationPub]] topic to [[TWikiRegistration]]. Do that by either editing the topics in the%TWIKIWEB% web, or by renaming the `.txt` and `.txt,v` files in the `twiki/data/%TWIKIWEB%` directory.
    * **_HINT:_** You can customize the registration form by deleting or adding input tags. The `name=""` parameter of the input tags must start with: `"Twk0..."` (if this is an optional entry), or `"Twk1..."` (if this is a required entry). This ensures that the fields are processed correctly.
* Register yourself in the [[TWikiRegistration]] topic.
  * **_NOTE:_** When a user registers, a new line with the username and encrypted password is added to the `data/.htpasswd` file. The `.htpasswd` file that comes with the TWiki installation includes user accounts for TWiki core team members that are used for testing on TWiki.org. You can edit the file and delete those lines.
* Create a new topic to check if authentication works.
* Edit the %MAINWEB%.TWikiAdminGroup topic in the TWiki:%MAINWEB% web to include users with system administrator status.
* Edit the [[TWikiPreferences]] topic in the TWiki:%TWIKIWEB% web to set access privileges.
* Edit the [[WebPreferences]] topic in each web, if necessary: set access priviliges.

<a name="CreateWeb"></a>

### <a name="Adding_a_New_Web"> Adding a New Web </a>

To create a new web:

1. **Create** a new web data directory under `twiki/data` and check the file permission of the directory.
  * Use a name starting with characters `A..Z`, followed by `a..z` and/or `0..9` characters, but **_not_** a [[WikiWord]].
2. **Copy** all files from the `twiki/data/_default` directory to the new data directory, preserving the original files' owner, group and permissions (on Unix, use `cp -p`). The data files must be writable by the owner the CGI scripts are running on (usually, `nobody`).
  * **_HINT:_** You can set permissions of `.txt` and `.txt,v` files to `-rw-rw-rw-` (666) and then edit the topic using your browser; RCS will restore the file permissions correctly when saving the topic.
3. **Add** the new web to the web list (visible in the upper right corner of each topic) by editing the site-level preferences, %TWIKIWEB%.%WIKIPREFSTOPIC%:
  * Add the new web to the <code>%WIKIWEBLIST%</code> variable.
4. **Update** the web settings by editing the WebPreferences topic of the new web:
  * Customize the <code>%WEBTOPICLIST%</code> variable to contain the web-specific links you prefer.
  * Set the WEBBGCOLOR variable to a color. The number represents the unique color for the web.
  * Set Plugins, access privileges, custom variables, other web-level options (ex: <code>%WEBCOPYRIGHT%</code> can be set for an individual web).
5. **Add** the new web to the color-coded web directory table by editing the %TWIKIWEB%.TWikiWebsTable topic.
6. **Test** the new web: view pages, create a new page.

That's it for a basic new web set-up!

Optionally, you can also:

* Create custom web-specific templates in a new `twiki/templates/Someweb` directory (otherwise, templates are inherited from `twiki/templates`).
* Add [[TWikiForms]] for form-based page input that's stored separately from the main free-form topic text.

**_NOTE:_** User home topics are located in the %WIKITOOLNAME%.%MAINWEB% web - don't try to move them or create them in other webs. From any other web, user signatures have to point to %WIKITOOLNAME%.%MAINWEB% web, using a <code>%MAINWEB%.UserName</code> or <code>%MAINWEB%.UserName</code> format. (The <code>%MAINWEB%</code> variable is an advantage if you ever change the %MAINWEB% web name, but the standard <code>%MAINWEB%.UserName</code> is easier for users to enter, which is the bottom line!

## <a name="TWiki_File_System_Info"> TWiki File System Info </a>

See [[AppendixFileSystem]] for an installed system snapshot and descriptions of all files in the TWiki 01-Sep-2001 distribution.

-- [[PeterThoeny]] - 13 Sep 2001 <br /> -- [[MikeMannix]] - 14 Sep 2001 <br />
