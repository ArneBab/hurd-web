# <a name="new_topic_for_the_final_doc"> new topic for the final doc </a>

Slightly edited down, but waiting for new docs, hopefully.

see also for ref: orig [[TWikiTemplatingSystem]] %TOC%

%STARTINCLUDE%

## <a name="TWiki_Template_System"> TWiki Template System </a>

_Define the templates used to render all HTML pages displayed in TWiki_

### <a name="Overview"> Overview </a>

We have a need for more advanced template handling. As [[Main/JohnTalintyre]] pointed out in [[CommonHeaderFooterTemplate]] it makes sense to separate the header and footer into one file so that it can be easily altered (or even overloaded by a skin). Also the oops dialog messages are all identical except for a few variables like heading, and so on.

Using external modules like the [[TemplateToolkit]] would be one way to go, but this will add a lot of baggage to TWiki.

### <a name="Needs_of_the_TWiki_templating_sy"> Needs of the TWiki templating system </a>

* Separate common parts into one (or more) base template file(s) and include that from other template files like `view.tmpl`.
* Define common variables like a "|" separator in the base template and use them in other template files
* Define variable text in templates (i.e. `view.tmpl`) and pass them to the base template

### <a name="Functional_Spec"> Functional Spec </a>

I tried to define a simple but powerful solution that can be extended over time. Here we go:

* Special template directives (or preprocessor commands) are embedded in normal templates.
* Use of template directives is optional, templates work without them.
* All template preprocessing is done in `&TWiki::Store::readTemplate()` so that the caller simply gets an expanded template file (the same as before)
* Directives are of form <code>%TMPL:&lt;key&gt;%</code> and <code>%TMPL:&lt;key&gt;\{"attr"\}%</code>.
* Initial set of directives:
  * <code>%TMPL:INCLUDE\{"file"\}%</code>: Includes a template file. The usual search path is applied.
  * <code>%TMPL:DEF\{"var"\}%</code>: Define a variable. Text between this and the END directive is not returned, but put into a hash for later use.
  * <code>%TMPL:END%</code>: Ends variable definition.
  * <code>%TMPL:P\{"var"\}%</code>: Prints a previously defined variable.
* New directives can be added over time when needed, i.e. IF-THEN-ELSE.
* Variables live in a global name space, there is no parameter passing.
* Two pass processing, so that you can use a variable before declaring it or after.
* Templates and skins work transparently and interchangeably. You could for example define a new skin just for the header &amp; footer and keep the other template files unchanged.
* **_Note:_** The template directive work only for templates, they do not get processed in topic text.

### <a name="Examples"> Examples </a>

Attached is an example of an oops base template `oopsbase.tmpl` and a example oops dialog `oopstest.tmpl` which is based on the base template. This is not the version that will go into the release, it is just a quick hack.

##### <a name="Base_template_oopsbase_tmpl"> Base template oopsbase.tmpl </a>

The first line declares the delimiter variable called "sep", used to separate multiple link items. The variable can be called anywhere by writing <code>%TMPL:P\{"sep"\}%</code>

**_Note:_** Added a dot to escape rendering of variables, i.e. read <code>**%.WEB%**</code> as <code>**%WEB%**</code>.

    <table border="1" cellspacing="0" cellpadding="1">
    <tr><td>
    <verbatim>
    %.TMPL:DEF{"sep"}% | %.TMPL:END%
    <html>
    <head>
      <title> %.WIKITOOLNAME% . %.WEB% . %.TOPIC% %.TMPL:P{"titleaction"}%</title>
      <base href="%.SCRIPTURL%/view%.SCRIPTSUFFIX%/%.WEB%/%.TOPIC%">
      <meta name="robots" content="noindex">
    </head>
    <body bgcolor="#FFFFFF">
    <table width="100%" border="0" cellpadding="3" cellspacing="0">
      <tr>
        <td bgcolor="%.WEBBGCOLOR%" rowspan="2" valign="top" width="1%">
          <a href="%.WIKIHOMEURL%">
          <img src="%.PUBURLPATH%/wikiHome.gif" border="0"></a>
        </td>
        <td>
          <b>%.WIKITOOLNAME% . %.WEB% . </b><font size="+2">
          <B>%.TOPIC%</b> %.TMPL:P{"titleaction"}%</font>
        </td>
      </tr>
      <tr bgcolor="%.WEBBGCOLOR%">
        <td colspan="2">
          %.TMPL:P{"webaction"}%
        </td>
      </tr>
    </table>
    --- ++ %.TMPL:P{"heading"}%
    %.TMPL:P{"message"}%
    <table width="100%" border="0" cellpadding="3" cellspacing="0">
      <tr bgcolor="%.WEBBGCOLOR%">
        <td valign="top">
          Topic <b>%TOPIC%</b> . {
            %.TMPL:P{"topicaction"}%
          }
        </td>
      </tr>
    </table>
    </body>
    </verbatim>
    </td></tr>
    </table >

##### <a name="Test_template_oopstest_tmpl"> Test template oopstest.tmpl </a>

Each oops template basically just defines some variables and includes the base template that does the layout work.

<table border="1" cellpadding="1" cellspacing="0">
  <tr>
    <td><pre>
%.TMPL:DEF{"titleaction"}% (test =titleaction=) %.TMPL:END%
%.TMPL:DEF{"webaction"}% test =webaction= %.TMPL:END%
%.TMPL:DEF{"heading"}%
Test heading %.TMPL:END%
%.TMPL:DEF{"message"}%
Test =message=. Blah blah blah blah blah blah blah blah blah blah blah...

   * Some more blah blah blah blah blah blah blah blah blah blah...
   * Param1: %PARAM1%
   * Param2: %PARAM2%
   * Param3: %PARAM3%
   * Param4: %PARAM4%
%.TMPL:END%
%.TMPL:DEF{"topicaction"}%
Test =topicaction=:
[[%.WEB%.%TOPIC%][OK]] %.TMPL:P{"sep"}%
[[%.TWIKIWEB%.TWikiRegistration][Register]] %.TMPL:END%
%.TMPL:INCLUDE{"oopsbase"}%
</pre></td>
  </tr>
</table>

##### <a name="Sample_screen_shot_of_oopstest_t"> Sample screen shot of oopstest.tmpl </a>

With URL: <code>**.../bin/oops/Test/TestTopic2?template=oopstest&amp;param1=WebHome&amp;param2=WebNotify**</code>

<table border="1" cellpadding="1" cellspacing="0">
  <tr>
    <td><img alt="testscreen.gif" height="304" src="%ATTACHURLPATH%/testscreen.gif" width="554" /></td>
  </tr>
</table>

### <a name="Comments_and_feedback"> Comments and feedback </a>

* The itching factor to put this into the upcoming release is to easy the pending converstion of the templates into XHTML format and to have a more flexible solution for templates and skins.
* Is the terminology OK?
* Is the spec OK?
* Are there any other directives that are needed urgently?
* One drawback by using the directives is that you can only test a template from within TWiki. This is because you don't have a text that has a linear flow when you use TMPL:DEF, TMPL:P and TMPL:INCLUDE.

-- [[Main/PeterThoeny]] - 21 Jul 2001 <br />

* It's probably more readable to enforce variables being defined before use, which would avoid need for slower two-pass processing.
  * [ [[Main/PeterThoeny]] ] You need two-pass processing because you need to define the "|" separator in the included template onone side, and on the other side define variables for the included template. The processing happens as regex in memory, so there is no mesurable speed penalty.
* It would be nice to simplify the syntax a bit, e.g. not using "" around variable names (they don't really need it, unlike filenames), and not using braces - however, this is not a big deal and there is some merit in keeping consistent with the current TWiki syntax.
  * [ [[Main/PeterThoeny]] ] The templating system uses the standard internal TWiki function to parse variable attributes. The "" can be skipped (is possible but is not documented).

Please have a look at the latest templates in the [[TWikiAlphaRelease]]. There is now one master template called `twiki.tmpl` that all other templates include (well, will include when all done). The idea is to define all common parts of the templates in `twiki.tmpl` and simply use that from all other templates.

<table border="1" cellpadding="1" cellspacing="0">
  <tr>
    <th bgcolor="#99CCCC"><strong>Template variable:</strong></th>
    <th bgcolor="#99CCCC"><strong>Defines:</strong></th>
  </tr>
  <tr>
    <td> %<nop>TMPL:DEF{"sep"}% </nop></td>
    <td> %TMPL:END% </td>
    <td> "|" separator </td>
  </tr>
  <tr>
    <td> %<nop>TMPL:DEF{"htmldoctype"}% </nop></td>
    <td> Start of all HTML pages </td>
  </tr>
  <tr>
    <td> %<nop>TMPL:DEF{"standardheader"}% </nop></td>
    <td> Standard header (for view, rdiff, ... </td>
  </tr>
  <tr>
    <td> %<nop>TMPL:DEF{"simpleheader"}% </nop></td>
    <td> Simple header with reduced links (for edit, attach, oops,...) </td>
  </tr>
  <tr>
    <td> %<nop>TMPL:DEF{"standardfooter"}% </nop></td>
    <td> Footer, excluding revision part and copyright part </td>
  </tr>
  <tr>
    <td> %<nop>TMPL:DEF{"oops"}% </nop></td>
    <td> Skeleton of oops dialog </td>
  </tr>
</table>

I.e. the `preview.tmpl` template is now simply:

<pre>
%<nop>TMPL:INCLUDE{"twiki"}%
%<nop>TMPL:DEF{"titleaction"}% (oops) %<nop>TMPL:END%
%<nop>TMPL:DEF{"webaction"}% *Attention* %<nop>TMPL:END%
%<nop>TMPL:DEF{"heading"}% Topic is not saved yet %<nop>TMPL:END%
%<nop>TMPL:DEF{"message"}%
  Please go back in your browser and save the topic. %<nop>TMPL:END%
%<nop>TMPL:DEF{"topicaction"}% %<nop>TMPL:END%
%<nop>TMPL:P{"oops"}%
</nop></nop></nop></nop></nop></nop></nop></nop></nop></nop></nop></nop></pre>

With this it should be possible to create a skin that overloads just the `twiki.tmpl`, i.e. a `twiki.print.tmpl` that redefines the header and footer.

-- [[Main/PeterThoeny]] - 23 Jul 2001 <br /> -- [[MikeMannix]] - 30 Aug 2001
