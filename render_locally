#!/bin/sh

# Render the pages of this repository.

# Written by Thomas Schwinge <tschwinge@gnu.org>

export ROOT && ROOT=$(readlink -f "$(dirname "$0")") &&

case $1 in
  --official)
    # Use this for rendering the set of pages which are to be installed under
    # <http://www.gnu.org/software/hurd/>.  Use ``--no-usedirs'' here, so that
    # not too many separate directories have to be created.
    shift &&
    export TZ && TZ=UTC &&
    export DESTDIR && DESTDIR=$ROOT.rendered.official &&
    set x \
      --set wikistatedir="$ROOT"/.ikiwiki-official \
      --url http://www.gnu.org/software/hurd \
      --no-usedirs \
      "$@" &&
    shift;;
  *)
    # Use ``--no-usedirs'' here, because when browsing local files, the web
    # browsers don't display `index.html' files by default when a hyperlink
    # referencing a directory is being opened.
    set x \
      --no-usedirs \
      "$@" &&
    shift;;
esac &&

ikiwiki \
  --setup "$ROOT"/ikiwiki.setup \
  --refresh \
  "$@" &&

echo &&
echo Now\ open\ \`"${DESTDIR-"$ROOT".rendered}"/index.html\'' to browse the web pages.'
